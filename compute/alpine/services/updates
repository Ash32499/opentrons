#!/sbin/openrc-run
# Opentrons updates server start script

PORT_NUMBER=8080

depend() {
  need localmount
}

start() {
  local retval

  ebegin "Starting updates proxy"
  start-stop-daemon --start \
      --background \
      --pidfile /var/run/updates.pid \
      --make-pidfile \
      --startas /bin/bash \
      -- -c "exec nc -lk -e updates.sh 127.0.0.1 $PORT_NUMBER > /var/log/updates.log 2>&1"
  retval=$?
  eend ${retval}
  return ${retval}
}

stop() {
  local retval

  ebegin "Stopping updates proxy"
  start-stop-daemon --stop --pidfile /var/run/updates.pid
  retval=$?
  eend ${retval}
  return ${retval}
}